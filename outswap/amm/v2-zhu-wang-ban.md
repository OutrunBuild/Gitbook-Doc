# V2（主网版）

**Outrun AMM V2** 仍然是常量积 AMM，但我们会对 Outrun AMM V1 继续做出改进，这些改进的灵感来自于 Uniswap V4，但是 Uniswap V4 的 AMM 模型为集中流动性 AMM，对长尾资产的支持不友好，所以 Outrun AMM V2 将会在常量积 AMM 的基础上引入以下主要改进：

#### 1. **架构优化**

* **单例池（Singleton Pool）**：V2 将引入了单例模式，所有流动性池都集成在一个智能合约（`PoolManager`）中，而不是像 V1 那样每个池都是独立部署的合约。这种设计显著降低了创建池和执行交易的 gas 成本。
* **闪电记账（Flash Accounting）**：允许用户在单个交易中完成多笔交易，并在最后统一结算，减少了中间步骤的 gas 消耗。

#### 2. **Hooks 功能**

* V2 将引入 Hooks，允许开发者在交易的前后执行自定义代码。这为限价订单、动态费用调整、自动流动性策略等功能提供了支持。

#### 3. **费用管理**

* **动态费用调整**：V2 允许流动性池自定义费用结构，不再局限于 V1 中固定的几个费率。
* **手续费再投资**：在添加流动性时，手续费收入可以直接转化为额外的流动性；在移除流动性时，未领取的手续费会自动提取。

#### 4. **用户体验提升**

* **原生 ETH 支持**：V2 允许直接使用原生 ETH 进行交易，无需再使用 Wrapped ETH（WETH），简化了交易流程。
* **流动性标记（Salt）**：在创建流动性时，可以通过 `salt` 参数区分同一池中的不同头寸，方便基金等机构管理多个流动性头寸。

#### 5. **性能优化**

* **代码优化**：V2 在代码层面进行了大量优化，例如使用无分枝函数和内联汇编来降低 gas 消耗。
* **瞬态存储技术**：利用以太坊的瞬态存储机制，仅在单个交易内存储临时数据，进一步降低了 gas 成本。

因为 **Outrun AMM V2 包含了** V1 版本的所有功能，所以在我们主网上线时，将会直接跳过 V1 版本直接部署 V2 版本，而 V1 版本仅作为**内测**版本。
